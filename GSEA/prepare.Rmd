---
title: "GSEA for CeVD"
author: "Chi-Lam Poon"
output: html_document
---

### Prepare files for running GSEA

1. `rnk` files for each tissue
2. `gmt` files
3. `gmt.list`
4. `tissue.names.txt`

See `rnk` format [documentation](http://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#RNK:_Ranked_list_file_format_.28.2A.rnk.29)

Select the gene symbol and t-statistics columns in the limma reports to generate rnk files.
```{bash prepare, eval=F}
cd /home/ubuntu/hdd/cevd/results/limma.tables
ls | sed 's/.tsv//g' > tissue.list
while read t; do cat $t.tsv | cut -f 2,5 | sed '1d' > ../../../gsea/rnk/$t.rnk; done < tissue.list

cd /home/ubuntu/hdd/gsea/gmt
rename 's/-/_/g' brain*.rnk # remove dash for file names
ls > ../gmt.list

cd /home/ubuntu/hdd/gsea/gmt/rnk
ls | sed 's/.rnk//g' > ../tissue.names.txt
```


### Functional enrichment analysis: perform pre-ranked GSEA 
Pre-ranked GSEA was conducted on gene lists ranked by the t-statistics from the results of DE analysis.

##### Install java 8
```{bash install, eval=F}
### install java 8:
sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update
sudo apt-get install oracle-java8-installer
# set up enviornment variables:
sudo vi /etc/environment
# add the two variables into the file:
JAVA_HOME=/usr/lib/jvm/java-8-oracle
JRE_HOME=/usr/lib/jvm/java-8-oracle/jre
source /etc/environment
echo $JAVA_HOME
```

Download gsea-3.0.jar & GOBP gmt file from [GSEA download site](http://software.broadinstitute.org/gsea/downloads.jsp) to the desktop, then send to ubuntu. [14 Dec 2018]

Java program: `gsea-3.0.jar`

GMT:
1. all GO gene sets: `c5.all.v6.2.symbols.gmt`
2. GO biological processes gene sets: `c5.bp.v6.2.symbols.gmt`

##### Transfer files
```{bash transfer, eval=F}
# run this command in macOS terminal:
scp -i ~/.ssh/chilampoon.pem ~/Desktop/gsea-3.0.jar ubuntu@sophie-r.genome.sg:/home/ubuntu/hdd/gsea

scp -i ~/.ssh/chilampoon.pem ~/Desktop/c5.all.v6.2.symbols.gmt ubuntu@sophie-r.genome.sg:/home/ubuntu/hdd/gsea
c5.all.v6.2.symbols.gmt

scp -i ~/.ssh/chilampoon.pem ~/Desktop/c5.bp.v6.2.symbols.gmt ubuntu@sophie-r.genome.sg:/home/ubuntu/hdd/gsea
c5.bp.v6.2.symbols.gmt 
```

##### Run Java program

`./run.prerank.sh > gsea.prerank.log`


